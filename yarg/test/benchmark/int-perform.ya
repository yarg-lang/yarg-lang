const reps_addsub = 90;
const reps_mul = 500;
const reps_div = 500;

// https://github.com/kraj/uClibc/blob/master/libc/stdlib/rand_r.c#L25
const maxRand = 0x7fffffff;
var seed = 0d173993;
fun rand()
{
    var next = seed;
    var result;

    next = next * 0d1103515245;
    next = next + 0d12345;
    result = (next / 0d65536) % 0d2048;

    next = next * 0d1103515245;
    next = next + 0d12345;
    result = result << 0d10;
    result = result ^ ((next / 0d65536) % 0d1024);

    next = next * 0d1103515245;
    next = next + 0d12345;
    result = result << 0d10;
    result = result ^ ((next / 0d65536) % 0d1024);

    seed = next;
    return next & maxRand;
}

const shifter = int(0x80000000);
var temp = new(int[4]);
fun int_rand()
{
    const size = rand() % 0d33; // max 33 * 31 => 1023 bits
    var int x = int(rand());

    for (var i = 0d0; i < size; i = i + 0d1)
    {
        x = x * shifter + int(rand());
    }

    if (size == 0d32)
    {
        if (rand() % 0d2 == 0d1)
        {
            x = x + 89884656743115795386465259539451236680898848947115328636715040578866337902750481566354238661203768010560056939935696678829394884407208311246423715319737062188883946712432742638151109800623047059726541476042502884419075341171231440736956555270413618581675255342293149119973622969239858152417678164812112068608;
        }
    }

    if (rand() % 0d2 == 0d1)
    {
        return -x;
    }
    else
    {
        return x;
    }
}

var rts = new(int[500]);
const zint = int(0);

for (var x = 0; x < 500; x = x + 1)
{
    var i = int_rand();
    if (i == zint)
    {
        print string(x) + " " + string(i);
    }
    rts[x] = i;
}

//print "out";
//for (var x = 0; x < 500; x = x + 1)
//{
//    var i = rts[x];
//    print x;
//    }
//}
//print rts[0];
//print rts[499];

var s1 = clock();
print "Add";
for (var i = 0; i < 500; i = i + 1) for (var j = 0; j < 500; j = j + 1) for (var k = 0; k < reps_addsub; k = k + 1)
{
    rts[i] + rts[j];
}
var t = mfloat64(clock() - s1);
print t;
print t / 500.0 / 500.0 / mfloat64(reps_addsub) * 1000.0;

s1 = clock();
print "Sub";
for (var i = 0; i < 500; i = i + 1) for (var j = 0; j < 500; j = j + 1) for (var k = 0; k < reps_addsub; k = k + 1)
{
    rts[i] - rts[j];
}
t = mfloat64(clock() - s1);
print t;
print t / 500.0 / 500.0 / mfloat64(reps_addsub) * 1000.0;

s1 = clock();
print "Mul";
for (var i = 0; i < reps_mul; i = i + 1) for (var j = 500 - reps_mul; j < 500; j = j + 1)
{
    rts[i] * rts[j];
}
t = mfloat64(clock() - s1);
print t;
print t / mfloat64(reps_mul * reps_mul) * 1000.0;

const zint = int(0);
s1 = clock();
print "Div";
for (var i = 0; i < 500; i = i + 1) for (var j = 500 - reps_div; j < 500; j = j + 1)
{
    if (rts[j] != zint)
    {
        rts[i] / rts[j];
    }
    else
    {
        print string(i) + " " + string(rts[i]);
        print "/ " + string(j) + " " + string(rts[j]);
    }
}
t = mfloat64(clock() - s1);
print t;
print t / mfloat64(reps_div * reps_div) * 1000.0;

//print rts;
